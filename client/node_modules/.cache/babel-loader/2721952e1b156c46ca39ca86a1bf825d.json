{"ast":null,"code":"import _objectSpread from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Link}from'react-router-dom';import moment from'moment';import axios from'axios';import GoogleMapReact from'google-map-react';import Spinner from'react-bootstrap/Spinner';import'./EventDetails.css';import EventService from'../../../service/events.service';import ReviewService from'../../../service/review.service';import Container from'react-bootstrap/Container';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import Modal from'react-bootstrap/Modal';import Button from'react-bootstrap/Button';import Toast from'react-bootstrap/Toast';import ReviewForm from'./../reviewForm/ReviewForm';var EventDetails=/*#__PURE__*/function(_Component){_inherits(EventDetails,_Component);var _super=_createSuper(EventDetails);function EventDetails(props){var _this;_classCallCheck(this,EventDetails);_this=_super.call(this,props);_this.handleModal=function(visible){return _this.setState({modalShow:visible});};_this.handleToast=function(visible){var text=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var toastCopy=_objectSpread({},_this.state.toast);toastCopy.show=visible;toastCopy.text=text;_this.setState({toast:toastCopy});};_this.handleEventSign=function(e){if(_this.state.event.attendance>0&&!_this.state.event.assistance.includes(_this.props.loggedInUser.username)){var eventCopy=_this.state.event;eventCopy.assistance.push(_this.props.loggedInUser._id);eventCopy.attendance-=1;_this.eventService.editEvent(eventCopy).then(function(response){return _this.setState({event:response.data});}).catch(function(err){return console.log(err);});}};_this.getEventsReviews=function(){console.warn(\"getEventReviews\");_this.reviewService.getEventReviews(_this.props.match.params.eventId).then(function(response){return _this.setState({reviews:response.data});}).catch(function(err){return console.log(err);});};_this.componentDidMount=function(){_this.getEventInfo();_this.getEventsReviews();};_this.finishEventPost=function(){_this.getAllEvents();_this.handleModal(false);_this.handleToast(true,'El comentario se ha creado con Ã©xito!');};_this.state={event:null,center:{lat:props.lat,lng:props.lng},attendance:0,loggedInUser:_this.props.loggedInUser,modalShow:false,toast:{show:false,text:''},reviews:[]};_this.reviewService=new ReviewService();_this.eventService=new EventService();_this.goBack=_this.goBack.bind(_assertThisInitialized(_this));return _this;}_createClass(EventDetails,[{key:\"goBack\",value:function goBack(){this.props.history.goBack();}},{key:\"getEventInfo\",value:function getEventInfo(){var _this2=this;var id=this.props.match.params.eventId;this.eventService.getEvent(id).then(function(response){return _this2.setState({event:response.data,reviews:response.data.reviews},function(){return _this2.getGoogleMap();});}).catch(function(err){return console.log(err);});}},{key:\"getGoogleMap\",value:function getGoogleMap(){var _this3=this;var location=this.state.event.location;var key='AIzaSyA5zll-K3WnkRdKTRaRgbyeC_JkL76ygyM';axios.get(\"https://maps.googleapis.com/maps/api/geocode/json?address=\".concat(location,\"&key=\").concat(key)).then(function(geores){var latitude=geores.data.results[0].geometry.location.lat;var longitude=geores.data.results[0].geometry.location.lng;_this3.setState({center:{lat:latitude,lng:longitude}});});}},{key:\"render\",value:function render(){var _this4=this;if(this.state.event){var _this$state$event=this.state.event,author=_this$state$event.author,title=_this$state$event.title,description=_this$state$event.description,location=_this$state$event.location,attendance=_this$state$event.attendance,gameDate=_this$state$event.gameDate,assistance=_this$state$event.assistance;var isAttending=this.props.loggedInUser&&assistance&&assistance.length>0&&assistance.findIndex(function(user){return user._id===_this4.props.loggedInUser._id;})>-1;return/*#__PURE__*/React.createElement(Container,{as:\"section\",className:\"event-details\"},/*#__PURE__*/React.createElement(\"h1\",null,title),/*#__PURE__*/React.createElement(Row,{as:\"article\"},/*#__PURE__*/React.createElement(Col,{md:{span:6},className:\"map-button-event-details\"},/*#__PURE__*/React.createElement(\"div\",{id:\"map\"},/*#__PURE__*/React.createElement(GoogleMapReact,{bootstrapURLKeys:{key:'AIzaSyA5zll-K3WnkRdKTRaRgbyeC_JkL76ygyM'},center:this.state.center,defaultZoom:this.props.zoom},/*#__PURE__*/React.createElement(\"div\",{style:{backgroundImage:\"url('../../../../img/marker.png')\",width:'26px',height:'29px'},lat:this.state.center.lat,lng:this.state.center.lng}))),/*#__PURE__*/React.createElement(\"div\",{className:\"event-details-buttons\"},/*#__PURE__*/React.createElement(Button,{onClick:this.goBack,className:\"btn btn-event-details-back btn-one\"},\"Volver\"),this.state.loggedInUser&&/*#__PURE__*/React.createElement(Button,{onClick:this.handleEventSign,disabled:isAttending,className:\"btn btn-event-details-back btn-one\"},\"Apuntarme\"))),/*#__PURE__*/React.createElement(Col,{md:{span:5}},/*#__PURE__*/React.createElement(\"h4\",null,\"Detalles\"),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Autor: \"),\" \",author.username),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Descripci\\xF3n: \"),\" \",description),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Direcci\\xF3n: \"),\" \",location),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Plazas restantes: \"),\" \",attendance),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Asistentes: \"),!this.state.event&&!this.state.event.assistance?/*#__PURE__*/React.createElement(\"p\",null,\"No hay nadie apuntado, todav\\uFFFDa\"):this.state.event.assistance.map(function(user){return user.username;}).join(', ')),/*#__PURE__*/React.createElement(\"hr\",null),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Fecha: \"),\" \",moment(gameDate).format('DD/MM/YYYY h:mmA')),/*#__PURE__*/React.createElement(\"hr\",null),this.props.loggedInUser&&/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return _this4.handleModal(true);},block:true,style:{marginBottom:'20px'},className:\"btn-one\"},\"Dejar comentario\"),/*#__PURE__*/React.createElement(\"h4\",null,\"Comentarios: \"),this.state.reviews&&this.state.reviews.map(function(review){return/*#__PURE__*/React.createElement(\"div\",{className:\"review-box\"},/*#__PURE__*/React.createElement(\"p\",null,\" \",/*#__PURE__*/React.createElement(\"strong\",null,\"Autor:\"),\"  \",review.author.username),\"  \",/*#__PURE__*/React.createElement(\"p\",null,\" \",review.text),\" \");}))),/*#__PURE__*/React.createElement(Modal,{show:this.state.modalShow,onHide:function onHide(){return _this4.handleModal(false);}},/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(ReviewForm,{refreshReviews:this.getEventsReviews,loggedInUser:this.props.loggedInUser,eventId:this.state.event._id// updateReviews={this.updateReviews}\n,closeModal:function closeModal(){return _this4.handleModal(false);}}))),/*#__PURE__*/React.createElement(Toast,{onClose:function onClose(){return _this4.handletoast(false);},show:this.state.toast.show,delay:4000,autohide:true},/*#__PURE__*/React.createElement(Toast.Header,null,/*#__PURE__*/React.createElement(\"strong\",{className:\"mr-auto\"},\"Mensaje\")),/*#__PURE__*/React.createElement(Toast.Body,null,this.state.toast.text)));}else{return/*#__PURE__*/React.createElement(Spinner,{className:\"justify-content-center\",animation:\"border\",role:\"status\"},/*#__PURE__*/React.createElement(\"span\",{className:\"sr-only\"},\"Loading...\"));}}}]);return EventDetails;}(Component);EventDetails.defaultProps={center:{lat:40.420524,lng:-3.705128},zoom:16};export default EventDetails;","map":{"version":3,"sources":["/Users/alejandromurawczik/Movies/Programacion/ IronHack/Ironhack/week7/day5/BYOG/client/src/components/pages/eventDetails/EventDetails.js"],"names":["React","Component","Link","moment","axios","GoogleMapReact","Spinner","EventService","ReviewService","Container","Row","Col","Modal","Button","Toast","ReviewForm","EventDetails","props","handleModal","visible","setState","modalShow","handleToast","text","toastCopy","state","toast","show","handleEventSign","e","event","attendance","assistance","includes","loggedInUser","username","eventCopy","push","_id","eventService","editEvent","then","response","data","catch","err","console","log","getEventsReviews","warn","reviewService","getEventReviews","match","params","eventId","reviews","componentDidMount","getEventInfo","finishEventPost","getAllEvents","center","lat","lng","goBack","bind","history","id","getEvent","getGoogleMap","location","key","get","geores","latitude","results","geometry","longitude","author","title","description","gameDate","isAttending","length","findIndex","user","span","zoom","backgroundImage","width","height","map","join","format","marginBottom","review","handletoast","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Link } from 'react-router-dom'\n\nimport moment from 'moment'\nimport axios from 'axios'\nimport GoogleMapReact from 'google-map-react'\nimport Spinner from 'react-bootstrap/Spinner'\n\nimport './EventDetails.css'\n\nimport EventService from '../../../service/events.service'\nimport ReviewService from '../../../service/review.service'\n\nimport Container from 'react-bootstrap/Container'\nimport Row from 'react-bootstrap/Row'\nimport Col from 'react-bootstrap/Col'\nimport Modal from 'react-bootstrap/Modal'\nimport Button from 'react-bootstrap/Button'\nimport Toast from 'react-bootstrap/Toast'\n\nimport ReviewForm from './../reviewForm/ReviewForm'\n\nclass EventDetails extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tevent: null,\n\t\t\tcenter: {\n\t\t\t\tlat: props.lat,\n\t\t\t\tlng: props.lng\n\t\t\t},\n\t\t\tattendance: 0,\n\t\t\tloggedInUser: this.props.loggedInUser,\n\t\t\tmodalShow: false,\n\t\t\ttoast: {\n\t\t\t\tshow: false,\n\t\t\t\ttext: ''\n\t\t\t},\n\t\t\treviews: []\n\t\t}\n\t\tthis.reviewService = new ReviewService()\n\t\tthis.eventService = new EventService()\n        this.goBack = this.goBack.bind(this);\n\t}\n\n\tstatic defaultProps = {\n\t\tcenter: {\n\t\t\tlat: 40.420524,\n\t\t\tlng: -3.705128\n\t\t},\n\t\tzoom: 16\n\t}\n\n\n\tgoBack(){this.props.history.goBack()}\n\n\thandleModal = visible => this.setState({ modalShow: visible })\n\thandleToast = (visible, text = '') => {\n\t\tconst toastCopy = { ...this.state.toast }\n\t\ttoastCopy.show = visible\n\t\ttoastCopy.text = text\n\t\tthis.setState({ toast: toastCopy })\n\t}\n\n\thandleEventSign = e => {\n\t\tif (\n\t\t\tthis.state.event.attendance > 0 &&\n\t\t\t!this.state.event.assistance.includes(this.props.loggedInUser.username)\n\t\t) {\n\t\t\tlet eventCopy = this.state.event\n\t\t\teventCopy.assistance.push(this.props.loggedInUser._id)\n\t\t\teventCopy.attendance -= 1\n\t\t\tthis.eventService\n\t\t\t\t.editEvent(eventCopy)\n\t\t\t\t.then(response => this.setState({ event: response.data }))\n\t\t\t\t.catch(err => console.log(err))\n\t\t}\n\t}\n\n\n\tgetEventsReviews = () => {\n\t\tconsole.warn(\"getEventReviews\")\n\t\tthis.reviewService.getEventReviews(this.props.match.params.eventId)\n\t\t\t.then(response => this.setState({ reviews: response.data}))\n\t\t\t.catch(err => console.log(err))\n\t}\n\n\tgetEventInfo() {\n\t\tconst id = this.props.match.params.eventId\n\t\tthis.eventService\n\t\t\t.getEvent(id)\n\t\t\t.then(response =>\n\t\t\t\tthis.setState({ event: response.data, reviews: response.data.reviews }, () => this.getGoogleMap())\n\t\t\t)\n\t\t\t.catch(err => console.log(err))\n\t}\n\n\tgetGoogleMap() {\n\t\tlet location = this.state.event.location\n\t\tlet key = 'AIzaSyA5zll-K3WnkRdKTRaRgbyeC_JkL76ygyM'\n\t\taxios.get(`https://maps.googleapis.com/maps/api/geocode/json?address=${location}&key=${key}`).then(geores => {\n\t\t\tlet latitude = geores.data.results[0].geometry.location.lat\n\t\t\tlet longitude = geores.data.results[0].geometry.location.lng\n\t\t\tthis.setState({\n\t\t\t\tcenter: {\n\t\t\t\t\tlat: latitude,\n\t\t\t\t\tlng: longitude\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tcomponentDidMount = () => {\n\t\tthis.getEventInfo()\n\t\tthis.getEventsReviews()\n\t}\n\n\tfinishEventPost = () => {\n\t\tthis.getAllEvents()\n\t\tthis.handleModal(false)\n\t\tthis.handleToast(true, 'El comentario se ha creado con Ã©xito!')\n\t}\n\trender() {\n\t\tif (this.state.event) {\n\t\t\tconst { author, title, description, location, attendance, gameDate, assistance } = this.state.event\n\n\t\t\tconst isAttending =\n\t\t\t\tthis.props.loggedInUser &&\n\t\t\t\tassistance &&\n\t\t\t\tassistance.length > 0 &&\n\t\t\t\tassistance.findIndex(user => user._id === this.props.loggedInUser._id) > -1\n\t\t\treturn (\n\t\t\t\t<Container as='section' className='event-details'>\n\t\t\t\t\t<h1>{title}</h1>\n\n\t\t\t\t\t<Row as='article'>\n\t\t\t\t\t\t<Col md={{ span: 6 }} className='map-button-event-details'>\n\t\t\t\t\t\t\t<div id='map'>\n\t\t\t\t\t\t\t\t<GoogleMapReact\n\t\t\t\t\t\t\t\t\tbootstrapURLKeys={{ key: 'AIzaSyA5zll-K3WnkRdKTRaRgbyeC_JkL76ygyM' }}\n\t\t\t\t\t\t\t\t\tcenter={this.state.center}\n\t\t\t\t\t\t\t\t\tdefaultZoom={this.props.zoom}>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\tbackgroundImage: \"url('../../../../img/marker.png')\",\n\t\t\t\t\t\t\t\t\t\t\twidth: '26px',\n\t\t\t\t\t\t\t\t\t\t\theight: '29px'\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tlat={this.state.center.lat}\n\t\t\t\t\t\t\t\t\t\tlng={this.state.center.lng}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</GoogleMapReact>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className='event-details-buttons'>\n\t\t\t\t\t\t\t\t<Button onClick={this.goBack} className='btn btn-event-details-back btn-one'>\n\t\t\t\t\t\t\t\t\tVolver\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t{this.state.loggedInUser && (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={this.handleEventSign}\n\t\t\t\t\t\t\t\t\t\tdisabled={isAttending}\n\t\t\t\t\t\t\t\t\t\tclassName='btn btn-event-details-back btn-one'>\n\t\t\t\t\t\t\t\t\t\tApuntarme\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col md={{ span: 5 }}>\n\t\t\t\t\t\t\t<h4>Detalles</h4>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Autor: </strong> {author.username}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Descripci&#243;n: </strong> {description}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Direcci&#243;n: </strong> {location}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Plazas restantes: </strong> {attendance}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Asistentes: </strong>\n\t\t\t\t\t\t\t\t{!this.state.event && !this.state.event.assistance ? (\n\t\t\t\t\t\t\t\t\t<p>No hay nadie apuntado, todavï¿½a</p>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\tthis.state.event.assistance.map(user => user.username).join(', ')\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t<strong>Fecha: </strong> {moment(gameDate).format('DD/MM/YYYY h:mmA')}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t{this.props.loggedInUser && (\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={() => this.handleModal(true)}\n\t\t\t\t\t\t\t\t\tblock\n\t\t\t\t\t\t\t\t\tstyle={{ marginBottom: '20px' }}\n\t\t\t\t\t\t\t\t\tclassName='btn-one'>\n\t\t\t\t\t\t\t\t\tDejar comentario\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<h4>Comentarios: </h4>\n\t\t\t\t\t\t\t{this.state.reviews && this.state.reviews.map(review => <div className=\"review-box\"><p> <strong>Autor:</strong>  {review.author.username}</p>  <p> {review.text}</p> </div>)}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Row>\n\t\t\t\t\t<Modal show={this.state.modalShow} onHide={() => this.handleModal(false)}>\n\t\t\t\t\t\t<Modal.Body>\n\t\t\t\t\t\t\t<ReviewForm\n\t\t\t\t\t\t\t\trefreshReviews={this.getEventsReviews}\n\t\t\t\t\t\t\t\tloggedInUser={this.props.loggedInUser}\n\t\t\t\t\t\t\t\teventId={this.state.event._id}\n\t\t\t\t\t\t\t\t// updateReviews={this.updateReviews}\n\t\t\t\t\t\t\t\tcloseModal={() => this.handleModal(false)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Modal.Body>\n\t\t\t\t\t</Modal>\n\n\t\t\t\t\t<Toast\n\t\t\t\t\t\tonClose={() => this.handletoast(false)}\n\t\t\t\t\t\tshow={this.state.toast.show}\n\t\t\t\t\t\tdelay={4000}\n\t\t\t\t\t\tautohide>\n\t\t\t\t\t\t<Toast.Header>\n\t\t\t\t\t\t\t<strong className='mr-auto'>Mensaje</strong>\n\t\t\t\t\t\t</Toast.Header>\n\t\t\t\t\t\t<Toast.Body>{this.state.toast.text}</Toast.Body>\n\t\t\t\t\t</Toast>\n\t\t\t\t</Container>\n\t\t\t)\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<Spinner className=\"justify-content-center\" animation='border' role='status'>\n\t\t\t\t\t<span className='sr-only'>Loading...</span>\n\t\t\t\t</Spinner>\n\t\t\t)\n\t\t}\n\t}\n}\nexport default EventDetails\n"]},"metadata":{},"sourceType":"module"}